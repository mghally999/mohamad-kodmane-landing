{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 136, "column": 0}, "map": {"version":3,"sources":["file:///Users/mohamadkodmani/Desktop/mohamad-kodmane-landing/app/api/contact/route.js"],"sourcesContent":["// /api/contact/route.js\nimport { NextResponse } from \"next/server\";\nimport nodemailer from \"nodemailer\";\n\n// Create transporter once (cached between function calls)\nlet transporter;\n\nfunction createTransporter() {\n  if (!transporter) {\n    transporter = nodemailer.createTransport({\n      host: process.env.EMAIL_HOST,\n      port: Number(process.env.EMAIL_PORT),\n      secure: process.env.EMAIL_SECURE === \"true\",\n      auth: {\n        user: process.env.EMAIL_USER,\n        pass: process.env.EMAIL_PASS,\n      },\n      // Balanced pooling\n      pool: true,\n      maxConnections: 3,\n      maxMessages: 50,\n    });\n  }\n  return transporter;\n}\n\nexport async function POST(req) {\n  const start = Date.now();\n\n  try {\n    const data = await req.json();\n    const { fullName, email, phone, unitType, buyTimeline, message } = data;\n\n    // Validate required fields\n    if (\n      !fullName ||\n      !email ||\n      !phone ||\n      !unitType ||\n      !buyTimeline ||\n      !message\n    ) {\n      return NextResponse.json(\n        { success: false, message: \"Missing required fields\" },\n        { status: 400 },\n      );\n    }\n\n    // Get cached transporter\n    const transporter = createTransporter();\n\n    // Verify connection (adds ~0.5s but ensures reliability)\n    await transporter.verify();\n\n    // Send both emails in parallel\n    await Promise.all([\n      // Admin email\n      transporter.sendMail({\n        from: `\"Mohamad Kodmani\" <${process.env.EMAIL_USER}>`,\n        to: process.env.ADMIN_EMAIL,\n        subject: `New Consultation Request - ${unitType}`,\n        html: `\n          <h3>New Consultation Request</h3>\n          <p><strong>Name:</strong> ${fullName}</p>\n          <p><strong>Email:</strong> ${email}</p>\n          <p><strong>Phone:</strong> ${phone}</p>\n          <p><strong>Unit Type:</strong> ${unitType}</p>\n          <p><strong>Timeline:</strong> ${buyTimeline}</p>\n          <p><strong>Message:</strong><br/>${message}</p>\n        `,\n      }),\n      // Auto-reply\n      transporter.sendMail({\n        from: `\"Mohamad Kodmani\" <${process.env.EMAIL_USER}>`,\n        to: email,\n        subject: \"We received your consultation request\",\n        html: `\n          <h3>Thank you ${fullName}</h3>\n          <p>We received your request and will contact you within 24 hours.</p>\n          <p>Best regards,<br>Mohamad Kodmani Team</p>\n        `,\n      }),\n    ]);\n\n    // Calculate elapsed time\n    const elapsed = Date.now() - start;\n    console.log(`✅ Processed in ${elapsed}ms`);\n\n    // Add small delay if too fast (ensures minimum 1.5s total)\n    if (elapsed < 1500) {\n      await new Promise((resolve) => setTimeout(resolve, 1500 - elapsed));\n    }\n\n    return NextResponse.json({ success: true }, { status: 200 });\n  } catch (error) {\n    console.error(\"❌ Error:\", error);\n\n    // Calculate elapsed time even for errors\n    const elapsed = Date.now() - start;\n    if (elapsed < 1500) {\n      await new Promise((resolve) => setTimeout(resolve, 1500 - elapsed));\n    }\n\n    return NextResponse.json(\n      { success: false, message: \"Server error\" },\n      { status: 500 },\n    );\n  }\n}\n"],"names":[],"mappings":";;;;AAAA,wBAAwB;AACxB;AACA;;;AAEA,0DAA0D;AAC1D,IAAI;AAEJ,SAAS;IACP,IAAI,CAAC,aAAa;QAChB,cAAc,wMAAU,CAAC,eAAe,CAAC;YACvC,MAAM,QAAQ,GAAG,CAAC,UAAU;YAC5B,MAAM,OAAO,QAAQ,GAAG,CAAC,UAAU;YACnC,QAAQ,QAAQ,GAAG,CAAC,YAAY,KAAK;YACrC,MAAM;gBACJ,MAAM,QAAQ,GAAG,CAAC,UAAU;gBAC5B,MAAM,QAAQ,GAAG,CAAC,UAAU;YAC9B;YACA,mBAAmB;YACnB,MAAM;YACN,gBAAgB;YAChB,aAAa;QACf;IACF;IACA,OAAO;AACT;AAEO,eAAe,KAAK,GAAG;IAC5B,MAAM,QAAQ,KAAK,GAAG;IAEtB,IAAI;QACF,MAAM,OAAO,MAAM,IAAI,IAAI;QAC3B,MAAM,EAAE,QAAQ,EAAE,KAAK,EAAE,KAAK,EAAE,QAAQ,EAAE,WAAW,EAAE,OAAO,EAAE,GAAG;QAEnE,2BAA2B;QAC3B,IACE,CAAC,YACD,CAAC,SACD,CAAC,SACD,CAAC,YACD,CAAC,eACD,CAAC,SACD;YACA,OAAO,4LAAY,CAAC,IAAI,CACtB;gBAAE,SAAS;gBAAO,SAAS;YAA0B,GACrD;gBAAE,QAAQ;YAAI;QAElB;QAEA,yBAAyB;QACzB,MAAM,cAAc;QAEpB,yDAAyD;QACzD,MAAM,YAAY,MAAM;QAExB,+BAA+B;QAC/B,MAAM,QAAQ,GAAG,CAAC;YAChB,cAAc;YACd,YAAY,QAAQ,CAAC;gBACnB,MAAM,CAAC,mBAAmB,EAAE,QAAQ,GAAG,CAAC,UAAU,CAAC,CAAC,CAAC;gBACrD,IAAI,QAAQ,GAAG,CAAC,WAAW;gBAC3B,SAAS,CAAC,2BAA2B,EAAE,UAAU;gBACjD,MAAM,CAAC;;oCAEqB,EAAE,SAAS;qCACV,EAAE,MAAM;qCACR,EAAE,MAAM;yCACJ,EAAE,SAAS;wCACZ,EAAE,YAAY;2CACX,EAAE,QAAQ;QAC7C,CAAC;YACH;YACA,aAAa;YACb,YAAY,QAAQ,CAAC;gBACnB,MAAM,CAAC,mBAAmB,EAAE,QAAQ,GAAG,CAAC,UAAU,CAAC,CAAC,CAAC;gBACrD,IAAI;gBACJ,SAAS;gBACT,MAAM,CAAC;wBACS,EAAE,SAAS;;;QAG3B,CAAC;YACH;SACD;QAED,yBAAyB;QACzB,MAAM,UAAU,KAAK,GAAG,KAAK;QAC7B,QAAQ,GAAG,CAAC,CAAC,eAAe,EAAE,QAAQ,EAAE,CAAC;QAEzC,2DAA2D;QAC3D,IAAI,UAAU,MAAM;YAClB,MAAM,IAAI,QAAQ,CAAC,UAAY,WAAW,SAAS,OAAO;QAC5D;QAEA,OAAO,4LAAY,CAAC,IAAI,CAAC;YAAE,SAAS;QAAK,GAAG;YAAE,QAAQ;QAAI;IAC5D,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,YAAY;QAE1B,yCAAyC;QACzC,MAAM,UAAU,KAAK,GAAG,KAAK;QAC7B,IAAI,UAAU,MAAM;YAClB,MAAM,IAAI,QAAQ,CAAC,UAAY,WAAW,SAAS,OAAO;QAC5D;QAEA,OAAO,4LAAY,CAAC,IAAI,CACtB;YAAE,SAAS;YAAO,SAAS;QAAe,GAC1C;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}